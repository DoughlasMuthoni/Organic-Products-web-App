{% extends 'partials/base.html' %}
{% load static %}
{% block title %} Customer Dashboard {% endblock %}

{% block content %}
<body>
    <div class="dashboard-container">
      <!-- Sidebar -->
      <div class="sidebar p-3">
        <h4 class="text-center mb-4">Dashboard</h4>
        <nav class="nav flex-column">
          <a class="nav-link active text-dark" href="#" onclick="showSection('profile')">Profile</a>
          <a class="nav-link text-dark" href="#" onclick="showSection('dashboard')">Dashboard</a>
          <a class="nav-link text-dark" href="#" onclick="showSection('orders')">Orders</a>
          <a class="nav-link text-dark" href="#" onclick="showSection('track')">Track Your Order</a>
          <a class="nav-link text-dark" href="#" onclick="showSection('address')">My Address</a>
          <a class="nav-link text-dark" href="#" onclick="showSection('account')">Account Details</a>
          <a class="nav-link text-dark" href="#">Logout</a>
        </nav>
      </div>
      <!-- Main Content -->
      <div class="main-content">
        <!-- Profile Section -->
        <div id="profile-section">
          <h2 class="mb-4 text-success"> Update Profile</h2>
          <p class="text-muted">Welcome to your profile! Here, you can view and update your personal information.</p>
          <div class="card shadow-sm p-4">
            <div class="row align-items-center">
              {% if profile.image %}
                  <div class="col-md-4 text-center">
                    <img 
                        src="{{ profile.image.url }}" 
                        alt="Profile Picture" 
                        class="rounded-circle img-fluid" 
                        style="height: 150px; width: 150px; object-fit: cover;">
                  </div>
              {% else %}
                    <div>
                      <img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBwgHBgkIBwgKCgkLDRYPDQwMDRsUFRAWIB0iIiAdHx8kKDQsJCYxJx8fLT0tMTU3Ojo6Iys/RD84QzQ5OjcBCgoKDQwNGg8PGjclHyU3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3N//AABEIAJQAlAMBIgACEQEDEQH/xAAbAAEAAwEBAQEAAAAAAAAAAAAAAwQFAgEGB//EADIQAAICAQICCQMDBAMAAAAAAAABAgMEESESMQUTIjJBUVJhcRRCkYGhsTRicqIjU8H/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8A/cQAAAI7bYVRcpvRfyBIQXZVVW0pay8kUMjNst2hrCHtzZVAu2dIzb/44qPzuV5ZN8+9bL9NiIAeuTlzbb92ebgAdxtsjyskvhk0M66PN8XyVgBp1dIQltZFwftui3CcZxUotNPxRgnVdk6pcUJNMDeBTxs2NjUbOzN/hlwAAAAAAAHF1kaoOcnokBxk5EKK+KXN8o+ZkXWzulxTe/7IXWytsc5c/wCDgAAAAAAAAAAAAAAF7DzHFqu56x8JPw+SiAPoAZ+Bk8qZvf7WaAAAADJ6Qv623gi+zD92X8y3qaJSXeeyMYAAAAAAElVFlvcjqvPwLWHh8a47o9nwj5mikktEtEgM2HRs335xXxudvo1/9v8AqaAAyLMG6HJKa9is009GtH5H0BBkY1d8e0tJeElzAxgd3VSpnwT5+HucAAAATa5PR+Zs4l3XVKX3LZmMWcC3q70vtls//ANcHh6BmdJz1sjD0rUpEuVLjybH/dp+CIAAABYwaOut1fcju/f2K5rdH18GNF+MtwLKPQAAAAAACvmUddU9F21vFmOfQGNmw6vImlstdUBAAAATaeq5gAbtM+OqM/NanhX6OsX0+jfKTQAzJPik34ttngAAAADbxv6ev/FGIbODLixYey0AnAAAAAAAAMrpP+oX+JqmR0hNSyZafbsBWAAAAAT0W8EGvcEUYtrYAe3R4brF5SOCz0hDhyW/VuVgAAAF3o27hm65PaW6+SkE2mmtmgPoAVMPKVqUZvSz+S2AAAAA5nOMIuU2kkBzfYqqnN+HIxG3JuT5smy8h3z22guSIAAAAAAC9g08dLl/cC3hQ4MaC5arUAQ9J18VcZrnF6foZhvTipwcZLVNaMw7a3VNwlzTA5AAAAlhj22d2uXy1oBEW6c+yGimuNfO5z9DkehflD6HI9K/KAuRz6X3tYv3R087H9f+rKP0OR6F+UPocj0r8oCxZ0jHlXBv3lsUrrrLpa2S18kvAl+hyPSvyh9DkelflAVgTyw8iO7hqvZ6kMk4vSSafk1oB4AAB3RW7bYw9TODR6Mp0TufN7IC8uW2wPQAKfSFHWQ44Ltx8PNFwAfPnVdcrZqEFq3+xczsVxbtrXZfeS8Pcm6OVSp1i9Z/cB3j4ldSTfal5vw+CyAAAAAAAAAAOLK4WR0nFSXudgDJy8N0vjhvX+6KpvySaaa203MeVKnkuvH7S128kBzjUu+xRXd8WbUYqKSjslyRHj0RorUY7vxfmSgAAAAAAo34sq59bi7S8Yl4AVMfMjN8FnYs5aPxLZBfjV395aS9S5lfhy8buvrYLwAvgpw6Qrb4bE4SLMLa592cX8MDsAAAeNpc2l8kNmXRDnYn7LcCc4sshXHWbSRU+rtu2xqn/kxXhOcuPJm5y8lyA5lbbmvgpTjX9zLdFEKIaQW/i/MkilFaJJJeR6AAAAAAAAAAAAAAcTqrmu3BS+UVrMCjTWPFH4YAFO2DqekJzX6kanOXOcvyeAC3RiV26Obk/wBS1DDor5Vp/O56AJktNvI9AAAAAAAAAA//2Q==" style="height: 150px; width: 150px; object-fit: cover;">
                    </div>
              {% endif %}
              <div class="col-md-8">
                <h4 class="text-success">Your Information</h4>
                <form method="post" enctype="multipart/form-data" class="p-4 border rounded bg-light">
                  {% csrf_token %}
                  <div class="mb-3">
                    <label for="full_name" class="form-label">Full Name</label>
                    <input type="text" id="full_name" class="form-control" value="{{ profile.full_name }}" name="full_name">
                  </div>
                  <div class="mb-3">
                    <label for="bio" class="form-label">Bio</label>
                    <input type="text" id="bio" class="form-control" value="{{ profile.bio }}" name="bio">
                  </div>
                  <div class="mb-3">
                    <label for="phone" class="form-label">Contact</label>
                    <input type="text" id="phone" class="form-control" value="{{ profile.phone }}" name="phone">
                  </div>
                  <div class="mb-3">
                    {% if profile.verified == True %}
                    <span class="badge bg-success">Verified <i class="fas fa-check-circle"></i></span>
                    {% else %}
                    <span class="badge bg-danger">Not Verified <i class="fa fa-times"></i></span>
                    {% endif %}
                  </div>
                  <a href="{% url 'user_authens:profile-update' %}" >Edit Profile</a>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard-section" style="display: none;">
          <h2 class="mb-4">Hello Rosie!</h2>
          <p>
            From your account dashboard, you can easily check & view your
            <a href="#" class="text-success">recent orders</a>, manage your shipping and billing addresses, and 
            <a href="#" class="text-success">edit your password and account details</a>.
          </p>
          <div>
            <canvas style="height: 70px;" id="myChart"></canvas>
          </div>
        </div>

        <!-- Orders Section -->
        <div id="orders-section" class="table-container" style="display: none;">
          <h2 class="mb-4">Your Orders</h2>
          <table class="table table-striped table-bordered">
            <thead class="table-success">
              <tr>
                <th>Order</th>
                <th>Date</th>
                <th>Status</th>
                <th>Paid Status</th>
                <th>Total</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
            {% for o in orders_list %}
            <tr>
              <td><span>INVOICE_NO </span>{{ o.id }}</td>
              <td>{{ o.order_date }}</td>
              <td>Processing</td>
              {% if paid_status == True %}
              <td><span>✔️</span></td>
              {% else %}
              <td><i class="fa fa-times remove-icon"></i></td>
              {% endif %}
              <td><span>Ksh</span> {{ o.price }}</td>
              <td><a href="{% url 'core:order_details' o.id %}" class="btn btn-sm btn-success">View</a></td>
            </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- Track Your Order Section -->
        <div id="track-section" style="display: none;">
          <h2 class="mb-4">Track Your Order</h2>
          <p>Enter your order ID below to track your order.</p>
          <form>
            <div class="form-group">
              <label for="orderID">Order ID</label>
              <input type="text" id="orderID" class="form-control" placeholder="Enter Order ID">
            </div>
            <button type="submit" class="btn btn-primary mt-3">Track Order</button>
          </form>
        </div>

        <!-- My Address Section -->
        <div id="address-section" style="display: none;">
          <h2 class="mb-4">My Address</h2>
          <p>Manage your billing and shipping addresses below.</p>
          <form method="post">
            {% csrf_token %}
            <div class="form-group col-md-6">
              <input placeholder="Address" required="" class="form-control" name="address" type="text">
            </div>
            <div class="form-group col-md-6">
              <input placeholder="Phone" required="" class="form-control" name="phone" type="text">
            </div>
            <div class="col-md-12">
              <button type="submit" class="btn btn-fill-out submit font-weight-bold btn-success" name="submit" value="Submit">Save Address</button>
            </div>
          </form>

          <div class="row mt-4">
            {% for a in address %}
            <div class="col-md-3 mb-3">
              <div class="card p-3">
                <p><strong>Address {{ forloop.counter }}</strong></p>
                <p>{{ a.address }}</p>
                <p>{{ a.contact }}</p>
                {% if a.status %}
                <i data-address-id="{{ a.id }}" class="fas fa-check-circle text-success check{{ a.id }} check"></i>
                <button style="display: none;" data-address-id="{{ a.id }}" type="submit" class="btn submit btn-success make-default-address button{{ a.id }} check action_btn" name="submit" value="Submit">Make Default</button>
                {% else %}   
                <button data-address-id="{{ a.id }}" type="submit" class="btn submit make-default-address button{{ a.id }} check action_btn btn-success" name="submit" value="Submit">Make Default</button>
                <i style="display: none;" data-address-id="{{ a.id }}" class="fas fa-check-circle text-success check{{ a.id }} check"></i>
                {% endif %}
              </div>
            </div>
            {% endfor %}
          </div>
        </div>

        <!-- Account Details Section -->
        <div id="account-section" style="display: none;">
          <h2 class="mb-4">Account Details</h2>
          <p>Update your account details and change your password below.</p>
          <form>
            <div class="form-group">
              <label for="username">Username</label>
              <input type="text" id="username" class="form-control" value="Rosie">
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input type="email" id="email" class="form-control" value="rosie@example.com">
            </div>
            <div class="form-group">
              <label for="password">New Password</label>
              <input type="password" id="password" class="form-control">
            </div>
            <button type="submit" class="btn btn-primary mt-3">Save Changes</button>
          </form>
        </div>
      </div>
    </div>

    <!-- JavaScript for Content Toggle -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      const labels = {{ month|safe }};
      const data = {
        labels: labels,
        datasets: [{
          label: 'Orders per Month',
          backgroundColor: 'rgb(59, 183, 126)',
          borderColor: 'rgb(59, 183, 126)',
          data: {{ total_orders|safe }}
        }]
      };
      const config = {
        type: 'bar',
        data: data,
        options: {}
      };
      document.addEventListener('DOMContentLoaded', () => {
        const chartCanvas = document.getElementById('myChart');
        if (chartCanvas) {
          const myChart = new Chart(chartCanvas, config);
        }
      });

      function showSection(section) {
        document.querySelectorAll('.main-content > div').forEach(div => div.style.display = 'none');
        document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));

        const sectionElement = document.getElementById(`${section}-section`);
        if (sectionElement) sectionElement.style.display = 'block';

        const navLink = document.querySelector(`a[onclick="showSection('${section}')"]`);
        if (navLink) navLink.classList.add('active');
      }

      // Show profile by default
      showSection('profile');
    </script>
</body>
{% endblock %}
